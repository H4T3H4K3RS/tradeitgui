<script setup>
import { usePsStore } from "@/stores/usePsStore";

const loadMessage = ref("–ó–∞–≥—Ä—É–∂–∞–µ–º –∫—É—Ä—Å—ã...")
const store = usePsStore ();
const data = ref ([]);
const priorityCurrencies = new Set ([ "USD", "EUR", "RUB" ]);
store.fetchBank ({ bank: 'ruBanks' }).then (response => {
  data.value = response.data.data;
  data.value.sort (
    function (a, b) {
      if (priorityCurrencies.has (a.name) && !priorityCurrencies.has (b.name)) {
        return -1;
      }
      if (!priorityCurrencies.has (a.name) && priorityCurrencies.has (b.name)) {
        return 1;
      }
      return 0;
    }
  )
}).catch (error => {
  loadMessage.value = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤!"
  console.log (error);
})
let formatFloat = number => {
  let sign = number < 0 ? "-" : "";
  let intPart = Math.abs (parseInt (number));
  let floatPart = (Math.abs (number) % 1).toFixed (2).slice (2);
  return `<span class="text-h6">${sign}${intPart}</span>.${floatPart}`
}
let formatSigned = number => {
  let sign = number < 0 ? "-" : "+";
  let intPart = Math.abs (parseInt (number));
  let floatPart = (Math.abs (number) % 1).toFixed (2).slice (2);
  return `<span class="text-h6">${sign}${intPart}</span>.${floatPart}`
}
let formatPercent = number => {
  number *= 100
  let sign = number < 0 ? "-" : "+";
  let intPart = Math.abs (parseInt (number));
  let floatPart = (Math.abs (number) % 1).toFixed (2).slice (2);
  return `<span class="text-h6">${sign}${intPart}</span>.${floatPart}%`
}
</script>
<template>
  <div>
    <VCard
      class="mb-6"
    >
      <VCardText
        class="text-h4 px-10 font-weight-bold"
      >
        <VAvatar
          size="50"
          image="/src/assets/images/misc/currencies/fiat/RUB.png"
        />
        –û—Å–Ω–æ–≤–Ω—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –±–∞–Ω–∫–æ–≤ –†–§
      </VCardText>
      <template
        v-for="currency in data"
        :key="currency.name"
      >
        <VCardText
          class="text-h5 font-weight-bold"
        >
          –û–±–º–µ–Ω {{ currency.name }} –≤ –†–§
        </VCardText>
        <VTable class="text-no-wrap pb-10 px-10">
          <!-- üëâ Table head -->
          <thead>
          <tr>

            <th
              scope="col"
              class="text-subtitle-1"
            >
              –ë–∞–Ω–∫
            </th>
            <th
              scope="col"
              class="text-subtitle-1"
            >
              –í–∞–ª—é—Ç–∞
            </th>
            <th
              scope="col"
              class="text-subtitle-1"
            >
              –ü–æ–∫—É–ø–∫–∞
            </th>
            <th
              scope="col"
              class="text-subtitle-1"
            >
              –ü—Ä–æ–¥–∞–∂–∞
            </th>
            <th
              scope="col"
              class="text-subtitle-1"
            >
              % –∑–∞–∑–æ—Ä
              <br>
              –æ—Ç –ø–æ–∫—É–ø–∫–∏ –Ω–∞ MOEX
            </th>
            <th
              scope="col"
              class="text-subtitle-1"
            >
              % —Å–ø—Ä–µ–¥
              <br>
              –æ—Ç –ø–æ–∫—É–ø–∫–∏ –Ω–∞ MOEX
            </th>
          </tr>
          </thead>

          <!-- üëâ Table Body -->
          <tbody>
          <tr
            v-for="item in currency.rates"
            :key="item.code"
            style="height: 3.5rem;"
          >

            <!-- üëâ Name -->
            <td>
              <div class="d-flex align-center gap-3">
                <VAvatar
                  rounded
                  variant="plain"
                  color="primary"
                  size="20"
                >
                  <VImg
                    :src="`/src/assets/images/misc/banks/small/${item.bank.toLowerCase()}.png`"
                  />
                </VAvatar>

                <div>
                  <h6 class="text-base text-medium-emphasis font-weight-semibold">
                    {{ item.bank }}
                  </h6>
                </div>
              </div>
            </td>

            <!-- üëâ Leader -->
            <td class="text-high-emphasis text-h6 font-weight-bold">
              {{ item.code }}
            </td>

            <td class="text-medium-emphasis"
                v-html="formatFloat(item.priceBuy)"
            >
            </td>

            <td class="text-medium-emphasis"
                v-html="formatFloat(item.priceSell)"
            >
            </td>
            <td class="text-medium-emphasis"
                v-html="formatSigned(item.moexZazor)"
            >
            </td>
            <td class="text-medium-emphasis"
                v-html="formatSigned(item.moexSpread)"
            >
            </td>
          </tr>
          </tbody>

        </VTable>
      </template>
      <template
        v-if="!data.length"
      >
        <VCardItem>
          <div
            colspan="8"
            class="text-center text-body-1 justify-center align-center"
          >
            {{ loadMessage }}&nbsp;
            <VProgressCircular
              :width="3"
              color="primary"
              indeterminate
            />
          </div>
        </VCardItem>
      </template>
    </VCard>
  </div>
</template>
<route lang="yaml">
meta:
  title: Russian Federation - Rates
</route>
