import{R as Y,X as Z,aQ as G,a6 as ee,p as a,k as h,v as W,aR as Q,aw as F,w as N,ad as ae,ae as te,o as t,c as k,q as s,F as B,a as A,s as R,m as l,x as e,aS as se,L as le,z as y,b as u,C as m,G as P,I as X,ay as q,az as K,am as E,r as O,H as S,A as oe,P as re,aT as ne,aU as ie,af as M,D as j,aN as ue,aV as ce,ax as de,ar as J,aq as me,j as ve,aW as fe,a9 as pe,aa as _e}from"./index.b24e0408.js";import{_ as he}from"./DialogCloseBtn.d07eb7be.js";import{f as ge}from"./formatters.1dc76301.js";import{V as ye}from"./VForm.848bd7c4.js";import{u as xe,V as be,a as ke,b as Ve,c as we}from"./VTabs.77d5f76b.js";import{V as Se}from"./VDialog.461b7277.js";import{V as $e,a as Ce}from"./VTable.7eeabefa.js";const Ie=Y({name:"VMain",props:{scrollable:Boolean,...Z({tag:"main"})},setup(D,r){let{slots:g}=r;const{mainStyles:b}=G(),{ssrBootStyles:$}=xe();return ee(()=>{var f,i;return a(D.tag,{class:["v-main",{"v-main--scrollable":D.scrollable}],style:[b.value,$.value]},{default:()=>[D.scrollable?a("div",{class:"v-main__scroller"},[(f=g.default)==null?void 0:f.call(g)]):(i=g.default)==null?void 0:i.call(g)]})}),{}}});const ze={class:"chat-log pa-5"},De={class:"text-xs me-1 text-disabled"},Pe={__name:"ChatLog",props:{trade:{type:Object,default:()=>{},required:!0}},setup(D){const r=D,g="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Font_Awesome_5_solid_user-circle.svg/1200px-Font_Awesome_5_solid_user-circle.svg.png",b=h(600),$=h(null),f=W(),i=Q(),x=h({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u{1F9E0}",status:0}),v=F(()=>({id:f.userData.id,avatar:g})),I=c=>c.state==="shown"?{icon:"tabler-checks",color:"success"}:{icon:"tabler-check",color:void 0},C=h(null);N(()=>{C.value===null?x.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u{1F9E0}",status:0}:C.value.length===0&&(x.value={message:"\u041D\u0435\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439",status:2})}),ae(()=>{L(),$.value=setInterval(L,1e3)}),te(()=>{clearInterval($.value)});const L=(c=!0)=>{c&&b.value<=0||(c||(x.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),b.value-=1)};N(()=>{if(b.value===0){console.log("Reload");return}i.fetchItems({trade:r.trade.id}).then(c=>{if(c.status>399)throw`\u041E\u0448\u0438\u0431\u043A\u0430: ${c.status}`;console.log(c.data),C.value=c.data.results}).catch(c=>{snackbar.value={enabled:!0,message:c,type:"error"}})});const T=F(()=>{const c=[];let V=C.value;if(!V||V.length===0)return[];let U=V[0].user,n={senderId:U,messages:[]};return V.forEach((w,d)=>{U===w.user?n.messages.push({message:w.message,time:w.time_created,state:w.state}):(U=w.user,c.push(n),n={senderId:w.user,messages:[{message:w.message,time:w.time_created,state:w.state}]}),d===V.length-1&&c.push(n)}),c});return(c,V)=>{var U;return t(),k("div",ze,[(U=s(T))!=null&&U.length?(t(!0),k(B,{key:0},A(s(T),(n,w)=>(t(),k("div",{key:n.senderId+String(w),class:R(["chat-group d-flex align-start",[{"flex-row-reverse":n.senderId===s(v).id,"mb-8":s(T).length-1!==w}]])},[l("div",{class:R(["chat-avatar",n.senderId===s(v).id?"ms-4":"me-4"])},[a(le,{size:"38"},{default:e(()=>[a(se,{src:n.senderId!==s(v).id?s(v).avatar:g},null,8,["src"])]),_:2},1024)],2),l("div",{class:R(["chat-body d-inline-flex flex-column",n.senderId===s(v).id?"align-end":"align-start"])},[(t(!0),k(B,null,A(n.messages,(d,p)=>(t(),k("p",{key:d.time,class:R(["chat-content text-sm py-3 px-4 elevation-1",[n.senderId!==s(v).id?"bg-surface chat-left":"bg-primary text-white chat-right",n.messages.length-1!==p?"mb-2":"mb-1"]])},y(d.message),3))),128)),l("div",{class:R({"text-right":n.senderId===s(v).id})},[l("span",De,y(s(ge)(n.messages[n.messages.length-1].time,{hour:"numeric",minute:"numeric"})),1),n.senderId===s(v).id?(t(),u(P,{key:0,size:"16",color:I(n.messages[n.messages.length-1]).color},{default:e(()=>[m(y(I(n.messages[n.messages.length-1]).icon),1)]),_:2},1032,["color"])):X("",!0)],2)],2)],2))),128)):(t(),u(E,{key:1},{default:e(()=>[a(q,{class:"d-flex justify-center text-center text-body-1 align-center"},{default:e(()=>[m(y(s(x).message)+" ",1),s(x).status===0?(t(),u(K,{key:0,width:3,color:"primary",indeterminate:""})):s(x).status===1?(t(),u(P,{key:1,color:"success",icon:"tabler-tick"})):(t(),u(P,{key:2,color:"error",icon:"tabler-x"}))]),_:1})]),_:1}))])}}},Te={class:"d-flex flex-column h-100"},Ue={class:"active-chat-header d-flex align-center text-medium-emphasis"},Be={class:"d-flex align-center cursor-pointer"},Le={class:"ms-4 mb-4 overflow-hidden"},Me={class:"text-h5 font-weight-regular"},Re={__name:"Chat",props:{trade:{type:Object,default:()=>{},required:!0}},setup(D){const r=D,g=Q(),b=h(),$=()=>{const x=b.value.$el||b.value;x.scrollTop=x.scrollHeight},f=h(""),i=()=>{!f.value||(g.postItem({trade:r.trade.id,message:f.value}),console.log(`Msg sent ${f.value}`),f.value="",ue(()=>{$()}))};return(x,v)=>{const I=O("RouterLink"),C=O("PerfectScrollbar");return t(),k("div",null,[a(Ie,{class:"chat-content-container"},{default:e(()=>[l("div",Te,[l("div",Ue,[l("div",Be,[l("div",Le,[l("h6",Me,[r.trade.item1?(t(),u(I,{key:0,to:{name:"items-view-id",params:{id:r.trade.item1.id}}},{default:e(()=>[a(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[m(y(r.trade.item1.name),1)]),_:1})]),_:1},8,["to"])):(t(),u(S,{key:1,color:"error",size:"large",variant:"tonal"},{default:e(()=>[m(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1})),a(P,{icon:"tabler-replace"}),r.trade.item2?(t(),u(I,{key:2,to:{name:"items-view-id",params:{id:r.trade.item2.id}}},{default:e(()=>[a(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[m(y(r.trade.item2.name),1)]),_:1})]),_:1},8,["to"])):(t(),u(S,{key:3,color:"error",size:"large",variant:"tonal"},{default:e(()=>[m(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))])])]),a(oe)]),a(re),a(C,{ref_key:"chatLogPS",ref:b,tag:"ul",options:{wheelPropagation:!1},class:"flex-grow-1"},{default:e(()=>[a(Pe,{trade:r.trade},null,8,["trade"])]),_:1},512),a(ye,{class:"chat-log-message-form mx-5",onSubmit:ne(i,["prevent"])},{default:e(()=>[(t(),u(ie,{key:r.trade.id,modelValue:s(f),"onUpdate:modelValue":v[0]||(v[0]=L=>M(f)?f.value=L:null),variant:"solo",class:"chat-message-input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435...",density:"default",autofocus:""},{"append-inner":e(()=>[a(j,{class:"mt-n2",rounded:"pill",variant:"tonal",onClick:i},{default:e(()=>[m(" \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C ")]),_:1})]),_:1},8,["modelValue"]))]),_:1},8,["onSubmit"])])]),_:1})])}}},je={__name:"SendMessageDialog",props:{isDialogVisible:{type:Boolean,required:!0},trade:{type:Object,required:!0}},emits:["update:isDialogVisible"],setup(D,{emit:r}){const g=D,b=$=>{r("update:isDialogVisible",$)};return($,f)=>{const i=he;return t(),k("div",null,[a(Se,{width:$.$vuetify.display.lgAndUp?"40%":560,"model-value":g.isDialogVisible,"onUpdate:modelValue":b},{default:e(()=>[a(i,{onClick:f[0]||(f[0]=x=>b(!1))}),a(E,{class:"py-8"},{default:e(()=>[a(Re,{trade:g.trade},null,8,["trade"])]),_:1})]),_:1},8,["width","model-value"])])}}},Ne=l("thead",null,[l("tr",null,[l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," # "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0442\u0434\u0430\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0446\u0435\u043D\u043A\u0430 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u0421\u0442\u0430\u0442\u0443\u0441 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F ")])],-1),Ae={class:"text-high-emphasis"},Fe={class:"text-high-emphasis"},qe={class:"text-high-emphasis"},Oe={class:"text-high-emphasis"},Ee={class:"text-high-emphasis"},He={class:"text-high-emphasis"},Je={class:"text-high-emphasis"},We={class:"text-high-emphasis"},Qe={colspan:"8",class:"text-center text-body-1 justify-center align-center"},Xe={class:"text-sm text-disabled"},sa={__name:"index",setup(D){const r=h(""),g=h(!1),b=h([{name:"\u0412\u0441\u0435",value:""},{name:"\u0412 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435",value:"created"},{name:"\u041F\u0440\u0438\u043D\u044F\u0442\u044B\u0435",value:"accepted"},{name:"\u041E\u0442\u043A\u043B\u043E\u043D\u0451\u043D\u043D\u044B\u0435",value:"not_accepted"}]);ve();const $=ce(),f=W(),i=h(null),x=h(10),v=h(1),I=h(1),C=h(0),L=h({}),T=h({}),c=h({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),V=h({enabled:!1,type:"success",message:"Hello!"});N(()=>{i.value===null?c.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}:i.value.length===0&&(c.value={message:"\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432",status:2})}),N(()=>{i.value=null,$.fetchItems({state:r.value}).then(d=>{i.value=d.data.results,L.value=d.data.results.length>0?d.data.results[0]:null,C.value=d.data.count,I.value=parseInt(C.value/x.value)+1}).catch(d=>{V.value={enabled:!0,message:d,type:"error"},console.log(d)})}),N(()=>{v.value>I.value&&(v.value=I.value)});const U=F(()=>{const d=i.value&&i.value.length?(v.value-1)*x.value+1:0,p=i.value?i.value.length+(v.value-1)*x.value:0;return`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u044B \u0441 ${d} \u043F\u043E ${p} \u0438\u0437 ${C.value} \u0441\u0442\u0440\u043E\u043A`}),n=async(d,p)=>{$.patchItem({id:d,state:p}).then(z=>{if(console.log(z.data),i.value=i.value.filter(_=>_.id!==d),C.value-=1,I.value=parseInt(C.value/x.value)+1,z.status>250)throw`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F: ${JSON.stringify(z.data)}`;V.value={enabled:!0,message:`\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0431\u043C\u0435\u043D\u0430 ${d} \u0438\u0437\u043C\u0435\u043D\u0451\u043D`,type:"success"}}).catch(z=>{V.value={enabled:!0,message:z,type:"error"},console.log(z)})},w=()=>{let d=r.value;r.value=null,r.value=d};return(d,p)=>{const z=O("RouterLink");return t(),k("div",null,[a(de,{modelValue:s(V).enabled,"onUpdate:modelValue":p[0]||(p[0]=_=>s(V).enabled=_),location:"bottom end",variant:"flat",color:s(V).type},{default:e(()=>[m(y(s(V).message),1)]),_:1},8,["modelValue","color"]),a(me,null,{default:e(()=>[a(J,{cols:"12",sm:"8",class:"w-100 d-flex d-md-block justify-center justify-md-start"},{default:e(()=>[a(be,{modelValue:s(r),"onUpdate:modelValue":p[1]||(p[1]=_=>M(r)?r.value=_:null),class:"mb-1"},{default:e(()=>[(t(!0),k(B,null,A(s(b),_=>(t(),u(Ve,{key:_.value,value:_.value},{default:e(()=>[m(y(_.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(J,{cols:"12",sm:"4"},{default:e(()=>[a(j,{class:"w-100","append-icon":"tabler-refresh",onClick:w},{default:e(()=>[m(" \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C ")]),_:1})]),_:1})]),_:1}),a(E,{flat:""},{default:e(()=>[a(q,null,{default:e(()=>[a(ke,{modelValue:s(r),"onUpdate:modelValue":p[3]||(p[3]=_=>M(r)?r.value=_:null)},{default:e(()=>[(t(!0),k(B,null,A(s(b),_=>(t(),u(we,{key:_.value,value:_.value},{default:e(()=>[a($e,{class:"text-no-wrap pb-5"},{default:e(()=>[Ne,l("tbody",null,[(t(!0),k(B,null,A(s(i),o=>(t(),k("tr",{key:o.id,style:{height:"3.5rem"}},[l("td",Ae,y(o.id),1),s(f).userData.id===o.user?(t(),k(B,{key:0},[l("td",Fe,[o.item1?(t(),u(z,{key:0,to:{name:"items-view-id",params:{id:o.item1.id}}},{default:e(()=>[a(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[m(y(o.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(t(),u(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[m(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))]),l("td",qe,[o.item2?(t(),u(z,{key:0,to:{name:"items-view-id",params:{id:o.item2.id}}},{default:e(()=>[a(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[m(y(o.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(t(),u(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[m(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))])],64)):(t(),k(B,{key:1},[l("td",Oe,[o.item2?(t(),u(z,{key:0,to:{name:"items-view-id",params:{id:o.item2.id}}},{default:e(()=>[a(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[m(y(o.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(t(),u(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[m(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))]),l("td",Ee,[o.item1?(t(),u(z,{key:0,to:{name:"items-view-id",params:{id:o.item1.id}}},{default:e(()=>[a(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[m(y(o.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(t(),u(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[m(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))])],64)),l("td",He,[a(S,{color:"warning",variant:"tonal","append-icon":"tabler-star"},{default:e(()=>[m(y(o.mark?o.mark:"-"),1)]),_:2},1024)]),l("td",Je,[a(S,{color:o.state==="created"?"warning":o.state==="accepted"?"success":"warning",variant:"tonal"},{default:e(()=>[m(y(fe(o.state)),1)]),_:2},1032,["color"])]),l("td",We,[o.state==="created"&&o.user!==s(f).userData.id?(t(),k(B,{key:0},[a(j,{icon:"",size:"x-small",color:"default",variant:"text",onClick:H=>n(o.id,"accepted")},{default:e(()=>[a(P,{size:"22",icon:"tabler-circle-check"})]),_:2},1032,["onClick"]),a(j,{icon:"",size:"x-small",color:"default",variant:"text",onClick:H=>n(o.id,"not_accepted")},{default:e(()=>[a(P,{size:"22",icon:"tabler-circle-x"})]),_:2},1032,["onClick"])],64)):X("",!0),a(j,{icon:"",size:"x-small",color:"default",variant:"text",onClick:H=>{T.value=JSON.parse(JSON.stringify(o)),g.value=!0}},{default:e(()=>[a(P,{size:"22",icon:"tabler-message"})]),_:2},1032,["onClick"])])]))),128))]),pe(l("tfoot",null,[l("tr",null,[l("td",Qe,[m(y(s(c).message)+" ",1),s(c).status===0?(t(),u(K,{key:0,width:3,color:"primary",indeterminate:""})):s(c).status===1?(t(),u(P,{key:1,color:"success",icon:"tabler-tick"})):(t(),u(P,{key:2,color:"error",icon:"tabler-x"}))])])],512),[[_e,!s(i)||!s(i).length]])]),_:1}),a(q,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3"},{default:e(()=>[l("span",Xe,y(s(U)),1),a(Ce,{modelValue:s(v),"onUpdate:modelValue":p[2]||(p[2]=o=>M(v)?v.value=o:null),size:"small","total-visible":4,length:s(I)},null,8,["modelValue","length"])]),_:1})]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(je,{trade:s(T),"onUpdate:trade":p[4]||(p[4]=_=>M(T)?T.value=_:null),"is-dialog-visible":s(g),"onUpdate:is-dialog-visible":p[5]||(p[5]=_=>M(g)?g.value=_:null)},null,8,["trade","is-dialog-visible"])]),_:1})])}}};export{sa as default};
