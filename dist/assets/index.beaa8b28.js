import{J as K,O as Q,bl as X,$ as Z,p as t,k as p,v as H,bm as W,am as N,w as R,bn as G,bo as ee,o as a,c as y,q as s,F as B,a as j,s as L,m as o,x as e,bp as te,G as ae,z as b,b as m,C as g,E as z,aY as A,be as O,ar as Y,b4 as E,r as q,H as S,A as se,bq as le,b0 as U,a4 as oe,br as re,bd as ne,j as ie,an as ue,az as ce}from"./index.94444e5e.js";import{_ as de}from"./DialogCloseBtn.915e8852.js";import{f as me}from"./formatters.1dc76301.js";import{V as ve}from"./VDivider.cffd7e90.js";import{V as fe}from"./VForm.c5c3949a.js";import{V as pe}from"./VTextField.cec6193b.js";import{V as F}from"./VBtn.ef78a3ba.js";import{u as _e,V as he,a as ge,b as be,c as ye}from"./VTabs.abcfe5bf.js";import{V as xe}from"./VDialog.b48f8ae5.js";import{V as ke,a as Ve}from"./VTable.eed5383c.js";import"./VCounter.39a2a584.js";import"./dialog-transition.5ff11eff.js";const we=K({name:"VMain",props:{scrollable:Boolean,...Q({tag:"main"})},setup(C,r){let{slots:_}=r;const{mainStyles:x}=X(),{ssrBootStyles:w}=_e();return Z(()=>{var h,i;return t(C.tag,{class:["v-main",{"v-main--scrollable":C.scrollable}],style:[x.value,w.value]},{default:()=>[C.scrollable?t("div",{class:"v-main__scroller"},[(h=_.default)==null?void 0:h.call(_)]):(i=_.default)==null?void 0:i.call(_)]})}),{}}});const $e={class:"chat-log pa-5"},Se={class:"text-xs me-1 text-disabled"},Ce={__name:"ChatLog",props:{trade:{type:Object,default:()=>{},required:!0}},setup(C){const r=C,_="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Font_Awesome_5_solid_user-circle.svg/1200px-Font_Awesome_5_solid_user-circle.svg.png",x=p(600),w=p(null),h=H(),i=W(),k=p({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u{1F9E0}",status:0}),v=N(()=>({id:h.userData.id,avatar:_})),I=c=>c.state==="shown"?{icon:"tabler-checks",color:"success"}:{icon:"tabler-check",color:void 0},D=p(null);R(()=>{D.value===null?k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u{1F9E0}",status:0}:D.value.length===0&&(k.value={message:"\u041D\u0435\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439",status:2})}),G(()=>{M(),w.value=setInterval(M,1e3)}),ee(()=>{clearInterval(w.value)});const M=(c=!0)=>{c&&x.value<=0||(c||(k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),x.value-=1)};R(()=>{if(x.value===0){console.log("Reload");return}i.fetchItems({trade:r.trade.id}).then(c=>{if(c.status>399)throw`\u041E\u0448\u0438\u0431\u043A\u0430: ${c.status}`;console.log(c.data),D.value=c.data}).catch(c=>{snackbar.value={enabled:!0,message:c,type:"error"}})});const P=N(()=>{const c=[];let V=D.value;if(!V||V.length===0)return[];let T=V[0].user,n={senderId:T,messages:[]};return V.forEach((l,d)=>{T===l.user?n.messages.push({message:l.message,time:l.time_created,state:l.state}):(T=l.user,c.push(n),n={senderId:l.user,messages:[{message:l.message,time:l.time_created,state:l.state}]}),d===V.length-1&&c.push(n)}),c});return(c,V)=>{var T;return a(),y("div",$e,[(T=s(P))!=null&&T.length?(a(!0),y(B,{key:0},j(s(P),(n,l)=>(a(),y("div",{key:n.senderId+String(l),class:L(["chat-group d-flex align-start",[{"flex-row-reverse":n.senderId===s(v).id,"mb-8":s(P).length-1!==l}]])},[o("div",{class:L(["chat-avatar",n.senderId===s(v).id?"ms-4":"me-4"])},[t(ae,{size:"38"},{default:e(()=>[t(te,{src:n.senderId!==s(v).id?s(v).avatar:_},null,8,["src"])]),_:2},1024)],2),o("div",{class:L(["chat-body d-inline-flex flex-column",n.senderId===s(v).id?"align-end":"align-start"])},[(a(!0),y(B,null,j(n.messages,(d,$)=>(a(),y("p",{key:d.time,class:L(["chat-content text-sm py-3 px-4 elevation-1",[n.senderId!==s(v).id?"bg-surface chat-left":"bg-primary text-white chat-right",n.messages.length-1!==$?"mb-2":"mb-1"]])},b(d.message),3))),128)),o("div",{class:L({"text-right":n.senderId===s(v).id})},[o("span",Se,b(s(me)(n.messages[n.messages.length-1].time,{hour:"numeric",minute:"numeric"})),1),n.senderId===s(v).id?(a(),m(z,{key:0,size:"16",color:I(n.messages[n.messages.length-1]).color},{default:e(()=>[g(b(I(n.messages[n.messages.length-1]).icon),1)]),_:2},1032,["color"])):A("",!0)],2)],2)],2))),128)):(a(),m(E,{key:1},{default:e(()=>[t(O,{class:"d-flex justify-center text-center text-body-1 align-center"},{default:e(()=>[g(b(s(k).message)+" ",1),s(k).status===0?(a(),m(Y,{key:0,width:3,color:"primary",indeterminate:""})):s(k).status===1?(a(),m(z,{key:1,color:"success",icon:"tabler-tick"})):(a(),m(z,{key:2,color:"error",icon:"tabler-x"}))]),_:1})]),_:1}))])}}},Ie={class:"d-flex flex-column h-100"},ze={class:"active-chat-header d-flex align-center text-medium-emphasis"},De={class:"d-flex align-center cursor-pointer"},Pe={class:"ms-4 mb-4 overflow-hidden"},Te={class:"text-h5 font-weight-regular"},Be={__name:"Chat",props:{trade:{type:Object,default:()=>{},required:!0}},setup(C){const r=C,_=W(),x=p(),w=()=>{const k=x.value.$el||x.value;k.scrollTop=k.scrollHeight},h=p(""),i=()=>{!h.value||(_.postItem({trade:r.trade.id,message:h.value}),console.log(`Msg sent ${h.value}`),h.value="",oe(()=>{w()}))};return(k,v)=>{const I=q("RouterLink"),D=q("PerfectScrollbar");return a(),y("div",null,[t(we,{class:"chat-content-container"},{default:e(()=>[o("div",Ie,[o("div",ze,[o("div",De,[o("div",Pe,[o("h6",Te,[r.trade.item1?(a(),m(I,{key:0,to:{name:"items-view-id",params:{id:r.trade.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[g(b(r.trade.item1.name),1)]),_:1})]),_:1},8,["to"])):A("",!0),t(z,{icon:"tabler-replace"}),r.trade.item2?(a(),m(I,{key:1,to:{name:"items-view-id",params:{id:r.trade.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[g(b(r.trade.item2.name),1)]),_:1})]),_:1},8,["to"])):A("",!0)])])]),t(se)]),t(ve),t(D,{ref_key:"chatLogPS",ref:x,tag:"ul",options:{wheelPropagation:!1},class:"flex-grow-1"},{default:e(()=>[t(Ce,{trade:r.trade},null,8,["trade"])]),_:1},512),t(fe,{class:"chat-log-message-form mx-5",onSubmit:le(i,["prevent"])},{default:e(()=>[(a(),m(pe,{key:r.trade.id,modelValue:s(h),"onUpdate:modelValue":v[0]||(v[0]=M=>U(h)?h.value=M:null),variant:"solo",class:"chat-message-input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435...",density:"default",autofocus:""},{"append-inner":e(()=>[t(F,{class:"mt-n2",rounded:"pill",variant:"tonal",onClick:i},{default:e(()=>[g(" \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C ")]),_:1})]),_:1},8,["modelValue"]))]),_:1},8,["onSubmit"])])]),_:1})])}}},Me={__name:"SendMessageDialog",props:{isDialogVisible:{type:Boolean,required:!0},trade:{type:Object,required:!0}},emits:["update:isDialogVisible"],setup(C,{emit:r}){const _=C,x=w=>{r("update:isDialogVisible",w)};return(w,h)=>{const i=de;return a(),y("div",null,[t(xe,{width:w.$vuetify.display.lgAndUp?"40%":560,"model-value":_.isDialogVisible,"onUpdate:modelValue":x},{default:e(()=>[t(i,{onClick:h[0]||(h[0]=k=>x(!1))}),t(E,{class:"py-8"},{default:e(()=>[t(Be,{trade:_.trade},null,8,["trade"])]),_:1})]),_:1},8,["width","model-value"])])}}},Ue=o("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," # ",-1),Le=o("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0442\u0434\u0430\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 ",-1),Re=o("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 ",-1),je=o("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0446\u0435\u043D\u043A\u0430 ",-1),Ae={key:0,scope:"col",class:"text-subtitle-2 text-wrap"},Fe={class:"text-high-emphasis"},Ne={class:"text-high-emphasis"},Oe={class:"text-high-emphasis"},qe={class:"text-high-emphasis"},Ee={class:"text-high-emphasis"},Je={class:"text-high-emphasis"},He={key:2,class:"text-high-emphasis"},We={colspan:"8",class:"text-center text-body-1 justify-center align-center"},Ye={class:"text-sm text-disabled"},nt={__name:"index",setup(C){const r=p("created"),_=p(!1),x=p([{name:"\u0412 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435",value:"created"},{name:"\u041E\u0442\u043A\u043B\u043E\u043D\u0451\u043D\u043D\u044B\u0435",value:"not_accepted"},{name:"\u041F\u0440\u0438\u043D\u044F\u0442\u044B\u0435",value:"accepted"}]);ie();const w=re(),h=H(),i=p(null),k=p(10),v=p(1),I=p(1),D=p(0),M=p({}),P=p({}),c=p({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),V=p({enabled:!1,type:"success",message:"Hello!"});R(()=>{i.value===null?c.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}:i.value.length===0&&(c.value={message:"\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432",status:2})}),R(()=>{i.value=null,w.fetchItems({state:r.value}).then(l=>{i.value=l.data,M.value=l.data.length>0?l.data[0]:null}).catch(l=>{V.value={enabled:!0,message:l,type:"error"},console.log(l)})}),R(()=>{v.value>I.value&&(v.value=I.value)});const T=N(()=>{const l=i.value&&i.value.length?(v.value-1)*k.value+1:0,d=i.value?i.value.length+(v.value-1)*k.value:0;return`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u044B \u0441 ${l} \u043F\u043E ${d} \u0438\u0437 ${D.value} \u0441\u0442\u0440\u043E\u043A`}),n=async(l,d)=>{w.patchItem({id:l,state:d}).then($=>{if(console.log($.data),i.value=i.value.filter(f=>f.id!==l),$.status>250)throw`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F: ${JSON.stringify($.data)}`;V.value={enabled:!0,message:`\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0431\u043C\u0435\u043D\u0430 ${l} \u0438\u0437\u043C\u0435\u043D\u0451\u043D`,type:"success"}}).catch($=>{V.value={enabled:!0,message:$,type:"error"},console.log($)})};return(l,d)=>{const $=q("RouterLink");return a(),y("div",null,[t(ne,{modelValue:s(V).enabled,"onUpdate:modelValue":d[0]||(d[0]=f=>s(V).enabled=f),location:"top end",variant:"flat",color:s(V).type},{default:e(()=>[g(b(s(V).message),1)]),_:1},8,["modelValue","color"]),t(he,{modelValue:s(r),"onUpdate:modelValue":d[1]||(d[1]=f=>U(r)?r.value=f:null),class:"mb-1"},{default:e(()=>[(a(!0),y(B,null,j(s(x),f=>(a(),m(be,{key:f.value,value:f.value},{default:e(()=>[g(b(f.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(E,{flat:""},{default:e(()=>[t(O,null,{default:e(()=>[t(ge,{modelValue:s(r),"onUpdate:modelValue":d[3]||(d[3]=f=>U(r)?r.value=f:null)},{default:e(()=>[(a(!0),y(B,null,j(s(x),f=>(a(),m(ye,{key:f.value,value:f.value},{default:e(()=>[t(ke,{class:"text-no-wrap pb-5"},{default:e(()=>[o("thead",null,[o("tr",null,[Ue,Le,Re,je,s(r)==="created"?(a(),y("th",Ae," \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F ")):A("",!0)])]),o("tbody",null,[(a(!0),y(B,null,j(s(i),u=>(a(),y("tr",{key:u.id,style:{height:"3.5rem"}},[o("td",Fe,b(u.id),1),s(h).userData.id===u.user?(a(),y(B,{key:0},[o("td",Ne,[u.item1?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[g(b(u.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[g(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))]),o("td",Oe,[u.item2?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[g(b(u.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[g(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))])],64)):(a(),y(B,{key:1},[o("td",qe,[u.item2?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[g(b(u.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[g(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))]),o("td",Ee,[u.item1?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[g(b(u.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[g(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))])],64)),o("td",Je,[t(S,{color:"warning",variant:"tonal","append-icon":"tabler-star"},{default:e(()=>[g(b(u.mark?u.mark:"-"),1)]),_:2},1024)]),u.state==="created"?(a(),y("td",He,[t(F,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>n(u.id,"accepted")},{default:e(()=>[t(z,{size:"22",icon:"tabler-circle-check"})]),_:2},1032,["onClick"]),t(F,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>n(u.id,"not_accepted")},{default:e(()=>[t(z,{size:"22",icon:"tabler-circle-x"})]),_:2},1032,["onClick"]),t(F,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>{P.value=JSON.parse(JSON.stringify(u)),_.value=!0}},{default:e(()=>[t(z,{size:"22",icon:"tabler-message"})]),_:2},1032,["onClick"])])):A("",!0)]))),128))]),ue(o("tfoot",null,[o("tr",null,[o("td",We,[g(b(s(c).message)+" ",1),s(c).status===0?(a(),m(Y,{key:0,width:3,color:"primary",indeterminate:""})):s(c).status===1?(a(),m(z,{key:1,color:"success",icon:"tabler-tick"})):(a(),m(z,{key:2,color:"error",icon:"tabler-x"}))])])],512),[[ce,!s(i)||!s(i).length]])]),_:1}),t(O,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3"},{default:e(()=>[o("span",Ye,b(s(T)),1),t(Ve,{modelValue:s(v),"onUpdate:modelValue":d[2]||(d[2]=u=>U(v)?v.value=u:null),size:"small","total-visible":4,length:s(I)},null,8,["modelValue","length"])]),_:1})]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Me,{trade:s(P),"onUpdate:trade":d[4]||(d[4]=f=>U(P)?P.value=f:null),"is-dialog-visible":s(_),"onUpdate:is-dialog-visible":d[5]||(d[5]=f=>U(_)?_.value=f:null)},null,8,["trade","is-dialog-visible"])]),_:1})])}}};export{nt as default};
