import{K as Y,P as Z,bl as G,a0 as ee,p as t,k as m,v as K,bm as Q,an as q,w as A,bn as te,bo as ae,o as s,c as x,q as a,F as M,a as F,s as j,m as l,x as e,bp as se,I as le,z as b,b as c,C as f,E as z,H as N,be as O,as as X,b4 as H,r as E,G as C,A as oe,bq as re,b0 as L,a5 as ne,br as ie,bd as ue,b9 as W,b8 as ce,j as de,bs as me,ao as ve,aA as fe}from"./index.803ecb77.js";import{_ as pe}from"./DialogCloseBtn.4894fe70.js";import{f as _e}from"./formatters.1dc76301.js";import{V as he}from"./VDivider.6ae5d827.js";import{V as ge}from"./VForm.1af9fe93.js";import{V as be}from"./VTextField.c1d00c1f.js";import{V as R}from"./VBtn.9b3fb4a1.js";import{u as ye,V as xe,a as ke,b as Ve,c as we}from"./VTabs.ab2ee98c.js";import{V as $e}from"./VDialog.38c0bf6e.js";import{V as Ce,a as Se}from"./VTable.d4d16beb.js";import"./VCounter.d6073169.js";import"./dialog-transition.159102fb.js";const Ie=Y({name:"VMain",props:{scrollable:Boolean,...Z({tag:"main"})},setup(I,r){let{slots:g}=r;const{mainStyles:y}=G(),{ssrBootStyles:$}=ye();return ee(()=>{var p,i;return t(I.tag,{class:["v-main",{"v-main--scrollable":I.scrollable}],style:[y.value,$.value]},{default:()=>[I.scrollable?t("div",{class:"v-main__scroller"},[(p=g.default)==null?void 0:p.call(g)]):(i=g.default)==null?void 0:i.call(g)]})}),{}}});const De={class:"chat-log pa-5"},ze={class:"text-xs me-1 text-disabled"},Pe={__name:"ChatLog",props:{trade:{type:Object,default:()=>{},required:!0}},setup(I){const r=I,g="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Font_Awesome_5_solid_user-circle.svg/1200px-Font_Awesome_5_solid_user-circle.svg.png",y=m(600),$=m(null),p=K(),i=Q(),k=m({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u{1F9E0}",status:0}),v=q(()=>({id:p.userData.id,avatar:g})),D=u=>u.state==="shown"?{icon:"tabler-checks",color:"success"}:{icon:"tabler-check",color:void 0},P=m(null);A(()=>{P.value===null?k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u{1F9E0}",status:0}:P.value.length===0&&(k.value={message:"\u041D\u0435\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439",status:2})}),te(()=>{U(),$.value=setInterval(U,1e3)}),ae(()=>{clearInterval($.value)});const U=(u=!0)=>{u&&y.value<=0||(u||(k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),y.value-=1)};A(()=>{if(y.value===0){console.log("Reload");return}i.fetchItems({trade:r.trade.id}).then(u=>{if(u.status>399)throw`\u041E\u0448\u0438\u0431\u043A\u0430: ${u.status}`;console.log(u.data),P.value=u.data.results}).catch(u=>{snackbar.value={enabled:!0,message:u,type:"error"}})});const T=q(()=>{const u=[];let V=P.value;if(!V||V.length===0)return[];let B=V[0].user,n={senderId:B,messages:[]};return V.forEach((w,d)=>{B===w.user?n.messages.push({message:w.message,time:w.time_created,state:w.state}):(B=w.user,u.push(n),n={senderId:w.user,messages:[{message:w.message,time:w.time_created,state:w.state}]}),d===V.length-1&&u.push(n)}),u});return(u,V)=>{var B;return s(),x("div",De,[(B=a(T))!=null&&B.length?(s(!0),x(M,{key:0},F(a(T),(n,w)=>(s(),x("div",{key:n.senderId+String(w),class:j(["chat-group d-flex align-start",[{"flex-row-reverse":n.senderId===a(v).id,"mb-8":a(T).length-1!==w}]])},[l("div",{class:j(["chat-avatar",n.senderId===a(v).id?"ms-4":"me-4"])},[t(le,{size:"38"},{default:e(()=>[t(se,{src:n.senderId!==a(v).id?a(v).avatar:g},null,8,["src"])]),_:2},1024)],2),l("div",{class:j(["chat-body d-inline-flex flex-column",n.senderId===a(v).id?"align-end":"align-start"])},[(s(!0),x(M,null,F(n.messages,(d,_)=>(s(),x("p",{key:d.time,class:j(["chat-content text-sm py-3 px-4 elevation-1",[n.senderId!==a(v).id?"bg-surface chat-left":"bg-primary text-white chat-right",n.messages.length-1!==_?"mb-2":"mb-1"]])},b(d.message),3))),128)),l("div",{class:j({"text-right":n.senderId===a(v).id})},[l("span",ze,b(a(_e)(n.messages[n.messages.length-1].time,{hour:"numeric",minute:"numeric"})),1),n.senderId===a(v).id?(s(),c(z,{key:0,size:"16",color:D(n.messages[n.messages.length-1]).color},{default:e(()=>[f(b(D(n.messages[n.messages.length-1]).icon),1)]),_:2},1032,["color"])):N("",!0)],2)],2)],2))),128)):(s(),c(H,{key:1},{default:e(()=>[t(O,{class:"d-flex justify-center text-center text-body-1 align-center"},{default:e(()=>[f(b(a(k).message)+" ",1),a(k).status===0?(s(),c(X,{key:0,width:3,color:"primary",indeterminate:""})):a(k).status===1?(s(),c(z,{key:1,color:"success",icon:"tabler-tick"})):(s(),c(z,{key:2,color:"error",icon:"tabler-x"}))]),_:1})]),_:1}))])}}},Te={class:"d-flex flex-column h-100"},Be={class:"active-chat-header d-flex align-center text-medium-emphasis"},Me={class:"d-flex align-center cursor-pointer"},Ue={class:"ms-4 mb-4 overflow-hidden"},Le={class:"text-h5 font-weight-regular"},je={__name:"Chat",props:{trade:{type:Object,default:()=>{},required:!0}},setup(I){const r=I,g=Q(),y=m(),$=()=>{const k=y.value.$el||y.value;k.scrollTop=k.scrollHeight},p=m(""),i=()=>{!p.value||(g.postItem({trade:r.trade.id,message:p.value}),console.log(`Msg sent ${p.value}`),p.value="",ne(()=>{$()}))};return(k,v)=>{const D=E("RouterLink"),P=E("PerfectScrollbar");return s(),x("div",null,[t(Ie,{class:"chat-content-container"},{default:e(()=>[l("div",Te,[l("div",Be,[l("div",Me,[l("div",Ue,[l("h6",Le,[r.trade.item1?(s(),c(D,{key:0,to:{name:"items-view-id",params:{id:r.trade.item1.id}}},{default:e(()=>[t(C,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[f(b(r.trade.item1.name),1)]),_:1})]),_:1},8,["to"])):N("",!0),t(z,{icon:"tabler-replace"}),r.trade.item2?(s(),c(D,{key:1,to:{name:"items-view-id",params:{id:r.trade.item2.id}}},{default:e(()=>[t(C,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[f(b(r.trade.item2.name),1)]),_:1})]),_:1},8,["to"])):N("",!0)])])]),t(oe)]),t(he),t(P,{ref_key:"chatLogPS",ref:y,tag:"ul",options:{wheelPropagation:!1},class:"flex-grow-1"},{default:e(()=>[t(Pe,{trade:r.trade},null,8,["trade"])]),_:1},512),t(ge,{class:"chat-log-message-form mx-5",onSubmit:re(i,["prevent"])},{default:e(()=>[(s(),c(be,{key:r.trade.id,modelValue:a(p),"onUpdate:modelValue":v[0]||(v[0]=U=>L(p)?p.value=U:null),variant:"solo",class:"chat-message-input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435...",density:"default",autofocus:""},{"append-inner":e(()=>[t(R,{class:"mt-n2",rounded:"pill",variant:"tonal",onClick:i},{default:e(()=>[f(" \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C ")]),_:1})]),_:1},8,["modelValue"]))]),_:1},8,["onSubmit"])])]),_:1})])}}},Re={__name:"SendMessageDialog",props:{isDialogVisible:{type:Boolean,required:!0},trade:{type:Object,required:!0}},emits:["update:isDialogVisible"],setup(I,{emit:r}){const g=I,y=$=>{r("update:isDialogVisible",$)};return($,p)=>{const i=pe;return s(),x("div",null,[t($e,{width:$.$vuetify.display.lgAndUp?"40%":560,"model-value":g.isDialogVisible,"onUpdate:modelValue":y},{default:e(()=>[t(i,{onClick:p[0]||(p[0]=k=>y(!1))}),t(H,{class:"py-8"},{default:e(()=>[t(je,{trade:g.trade},null,8,["trade"])]),_:1})]),_:1},8,["width","model-value"])])}}},Ae=l("thead",null,[l("tr",null,[l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," # "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0442\u0434\u0430\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0446\u0435\u043D\u043A\u0430 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u0421\u0442\u0430\u0442\u0443\u0441 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F ")])],-1),Fe={class:"text-high-emphasis"},Ne={class:"text-high-emphasis"},qe={class:"text-high-emphasis"},Oe={class:"text-high-emphasis"},Ee={class:"text-high-emphasis"},He={class:"text-high-emphasis"},Je={class:"text-high-emphasis"},We={class:"text-high-emphasis"},Ke={colspan:"8",class:"text-center text-body-1 justify-center align-center"},Qe={class:"text-sm text-disabled"},it={__name:"index",setup(I){const r=m(""),g=m(!1),y=m([{name:"\u0412\u0441\u0435",value:""},{name:"\u0412 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435",value:"created"},{name:"\u041F\u0440\u0438\u043D\u044F\u0442\u044B\u0435",value:"accepted"},{name:"\u041E\u0442\u043A\u043B\u043E\u043D\u0451\u043D\u043D\u044B\u0435",value:"not_accepted"}]);m(""),m([]),de();const $=ie(),p=K(),i=m(null),k=m(10),v=m(1),D=m(1),P=m(0),U=m({}),T=m({}),u=m({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),V=m({enabled:!1,type:"success",message:"Hello!"});A(()=>{i.value===null?u.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}:i.value.length===0&&(u.value={message:"\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432",status:2})}),A(()=>{i.value=null,$.fetchItems({state:r.value}).then(d=>{i.value=d.data.results,U.value=d.data.results.length>0?d.data.results[0]:null}).catch(d=>{V.value={enabled:!0,message:d,type:"error"},console.log(d)})}),A(()=>{v.value>D.value&&(v.value=D.value)});const B=q(()=>{const d=i.value&&i.value.length?(v.value-1)*k.value+1:0,_=i.value?i.value.length+(v.value-1)*k.value:0;return`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u044B \u0441 ${d} \u043F\u043E ${_} \u0438\u0437 ${P.value} \u0441\u0442\u0440\u043E\u043A`}),n=async(d,_)=>{$.patchItem({id:d,state:_}).then(S=>{if(console.log(S.data),i.value=i.value.filter(h=>h.id!==d),S.status>250)throw`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F: ${JSON.stringify(S.data)}`;V.value={enabled:!0,message:`\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0431\u043C\u0435\u043D\u0430 ${d} \u0438\u0437\u043C\u0435\u043D\u0451\u043D`,type:"success"}}).catch(S=>{V.value={enabled:!0,message:S,type:"error"},console.log(S)})},w=()=>{let d=r.value;r.value=null,r.value=d};return(d,_)=>{const S=E("RouterLink");return s(),x("div",null,[t(ue,{modelValue:a(V).enabled,"onUpdate:modelValue":_[0]||(_[0]=h=>a(V).enabled=h),location:"bottom end",variant:"flat",color:a(V).type},{default:e(()=>[f(b(a(V).message),1)]),_:1},8,["modelValue","color"]),t(ce,null,{default:e(()=>[t(W,{cols:"12",sm:"8",class:"w-100 d-flex d-md-block justify-center justify-md-start"},{default:e(()=>[t(xe,{modelValue:a(r),"onUpdate:modelValue":_[1]||(_[1]=h=>L(r)?r.value=h:null),class:"mb-1"},{default:e(()=>[(s(!0),x(M,null,F(a(y),h=>(s(),c(Ve,{key:h.value,value:h.value},{default:e(()=>[f(b(h.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(W,{cols:"12",sm:"4"},{default:e(()=>[t(R,{class:"w-100","append-icon":"tabler-refresh",onClick:w},{default:e(()=>[f(" \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C ")]),_:1})]),_:1})]),_:1}),t(H,{flat:""},{default:e(()=>[t(O,null,{default:e(()=>[t(ke,{modelValue:a(r),"onUpdate:modelValue":_[3]||(_[3]=h=>L(r)?r.value=h:null)},{default:e(()=>[(s(!0),x(M,null,F(a(y),h=>(s(),c(we,{key:h.value,value:h.value},{default:e(()=>[t(Ce,{class:"text-no-wrap pb-5"},{default:e(()=>[Ae,l("tbody",null,[(s(!0),x(M,null,F(a(i),o=>(s(),x("tr",{key:o.id,style:{height:"3.5rem"}},[l("td",Fe,b(o.id),1),a(p).userData.id===o.user?(s(),x(M,{key:0},[l("td",Ne,[o.item1?(s(),c(S,{key:0,to:{name:"items-view-id",params:{id:o.item1.id}}},{default:e(()=>[t(C,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[f(b(o.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),c(C,{key:1,color:"error",variant:"tonal"},{default:e(()=>[f(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))]),l("td",qe,[o.item2?(s(),c(S,{key:0,to:{name:"items-view-id",params:{id:o.item2.id}}},{default:e(()=>[t(C,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[f(b(o.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),c(C,{key:1,color:"error",variant:"tonal"},{default:e(()=>[f(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))])],64)):(s(),x(M,{key:1},[l("td",Oe,[o.item2?(s(),c(S,{key:0,to:{name:"items-view-id",params:{id:o.item2.id}}},{default:e(()=>[t(C,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[f(b(o.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),c(C,{key:1,color:"error",variant:"tonal"},{default:e(()=>[f(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))]),l("td",Ee,[o.item1?(s(),c(S,{key:0,to:{name:"items-view-id",params:{id:o.item1.id}}},{default:e(()=>[t(C,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[f(b(o.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),c(C,{key:1,color:"error",variant:"tonal"},{default:e(()=>[f(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))])],64)),l("td",He,[t(C,{color:"warning",variant:"tonal","append-icon":"tabler-star"},{default:e(()=>[f(b(o.mark?o.mark:"-"),1)]),_:2},1024)]),l("td",Je,[t(C,{color:o.state==="created"?"warning":o.state==="accepted"?"success":"warning",variant:"tonal"},{default:e(()=>[f(b(me(o.state)),1)]),_:2},1032,["color"])]),l("td",We,[o.state==="created"&&o.user!==a(p).userData.id?(s(),x(M,{key:0},[t(R,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>n(o.id,"accepted")},{default:e(()=>[t(z,{size:"22",icon:"tabler-circle-check"})]),_:2},1032,["onClick"]),t(R,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>n(o.id,"not_accepted")},{default:e(()=>[t(z,{size:"22",icon:"tabler-circle-x"})]),_:2},1032,["onClick"])],64)):N("",!0),t(R,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>{T.value=JSON.parse(JSON.stringify(o)),g.value=!0}},{default:e(()=>[t(z,{size:"22",icon:"tabler-message"})]),_:2},1032,["onClick"])])]))),128))]),ve(l("tfoot",null,[l("tr",null,[l("td",Ke,[f(b(a(u).message)+" ",1),a(u).status===0?(s(),c(X,{key:0,width:3,color:"primary",indeterminate:""})):a(u).status===1?(s(),c(z,{key:1,color:"success",icon:"tabler-tick"})):(s(),c(z,{key:2,color:"error",icon:"tabler-x"}))])])],512),[[fe,!a(i)||!a(i).length]])]),_:1}),t(O,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3"},{default:e(()=>[l("span",Qe,b(a(B)),1),t(Se,{modelValue:a(v),"onUpdate:modelValue":_[2]||(_[2]=o=>L(v)?v.value=o:null),size:"small","total-visible":4,length:a(D)},null,8,["modelValue","length"])]),_:1})]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Re,{trade:a(T),"onUpdate:trade":_[4]||(_[4]=h=>L(T)?T.value=h:null),"is-dialog-visible":a(g),"onUpdate:is-dialog-visible":_[5]||(_[5]=h=>L(g)?g.value=h:null)},null,8,["trade","is-dialog-visible"])]),_:1})])}}};export{it as default};
