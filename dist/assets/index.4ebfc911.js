import{J as K,O as Q,bl as X,$ as Z,p as t,k as g,v as H,bm as W,am as N,w as R,bn as G,bo as ee,o as s,c as x,q as a,F as B,a as j,s as L,m as l,x as e,bp as te,G as ae,z as b,b as m,C as h,E as D,aY as F,be as O,ar as Y,b4 as E,r as q,H as S,A as se,bq as le,b0 as U,a4 as oe,br as re,bd as ne,j as ie,an as ue,az as ce}from"./index.e86e570b.js";import{_ as de}from"./DialogCloseBtn.86d13dc9.js";import{f as me}from"./formatters.1dc76301.js";import{V as ve}from"./VDivider.f7fc2024.js";import{V as fe}from"./VForm.d4bb07bc.js";import{V as pe}from"./VTextField.281358d4.js";import{V as A}from"./VBtn.cb571138.js";import{u as ge,V as _e,a as he,b as be,c as ye}from"./VTabs.cc9be998.js";import{V as xe}from"./VDialog.a6fb88af.js";import{V as ke,a as Ve}from"./VTable.cef7db93.js";import"./VCounter.139d9023.js";import"./dialog-transition.07f67cb4.js";const we=K({name:"VMain",props:{scrollable:Boolean,...Q({tag:"main"})},setup(C,i){let{slots:_}=i;const{mainStyles:y}=X(),{ssrBootStyles:w}=ge();return Z(()=>{var f,u;return t(C.tag,{class:["v-main",{"v-main--scrollable":C.scrollable}],style:[y.value,w.value]},{default:()=>[C.scrollable?t("div",{class:"v-main__scroller"},[(f=_.default)==null?void 0:f.call(_)]):(u=_.default)==null?void 0:u.call(_)]})}),{}}});const $e={class:"chat-log pa-5"},Se={class:"text-xs me-1 text-disabled"},Ce={__name:"ChatLog",props:{trade:{type:Object,default:()=>{},required:!0}},setup(C){const i=C,_="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Font_Awesome_5_solid_user-circle.svg/1200px-Font_Awesome_5_solid_user-circle.svg.png",y=g(600),w=g(null),f=H(),u=W(),k=g({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u{1F9E0}",status:0}),v=N(()=>({id:f.userData.id,avatar:_})),I=c=>c.state==="shown"?{icon:"tabler-checks",color:"success"}:{icon:"tabler-check",color:void 0},z=g(null);R(()=>{z.value===null?k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u{1F9E0}",status:0}:z.value.length===0&&(k.value={message:"\u041D\u0435\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439",status:2})}),G(()=>{M(),w.value=setInterval(M,1e3)}),ee(()=>{clearInterval(w.value)});const M=(c=!0)=>{c&&y.value<=0||(c||(k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),y.value-=1)};R(()=>{if(y.value===0){console.log("Reload");return}u.fetchItems({trade:i.trade.id}).then(c=>{if(c.status>399)throw`\u041E\u0448\u0438\u0431\u043A\u0430: ${c.status}`;console.log(c.data),z.value=c.data}).catch(c=>{snackbar.value={enabled:!0,message:c,type:"error"}})});const P=N(()=>{const c=[];let V=z.value;if(!V||V.length===0)return[];let T=V[0].user,r={senderId:T,messages:[]};return V.forEach((o,d)=>{T===o.user?r.messages.push({message:o.message,time:o.time_created,state:o.state}):(T=o.user,c.push(r),r={senderId:o.user,messages:[{message:o.message,time:o.time_created,state:o.state}]}),d===V.length-1&&c.push(r)}),c});return(c,V)=>{var T;return s(),x("div",$e,[(T=a(P))!=null&&T.length?(s(!0),x(B,{key:0},j(a(P),(r,o)=>(s(),x("div",{key:r.senderId+String(o),class:L(["chat-group d-flex align-start",[{"flex-row-reverse":r.senderId===a(v).id,"mb-8":a(P).length-1!==o}]])},[l("div",{class:L(["chat-avatar",r.senderId===a(v).id?"ms-4":"me-4"])},[t(ae,{size:"38"},{default:e(()=>[t(te,{src:r.senderId!==a(v).id?a(v).avatar:_},null,8,["src"])]),_:2},1024)],2),l("div",{class:L(["chat-body d-inline-flex flex-column",r.senderId===a(v).id?"align-end":"align-start"])},[(s(!0),x(B,null,j(r.messages,(d,$)=>(s(),x("p",{key:d.time,class:L(["chat-content text-sm py-3 px-4 elevation-1",[r.senderId!==a(v).id?"bg-surface chat-left":"bg-primary text-white chat-right",r.messages.length-1!==$?"mb-2":"mb-1"]])},b(d.message),3))),128)),l("div",{class:L({"text-right":r.senderId===a(v).id})},[l("span",Se,b(a(me)(r.messages[r.messages.length-1].time,{hour:"numeric",minute:"numeric"})),1),r.senderId===a(v).id?(s(),m(D,{key:0,size:"16",color:I(r.messages[r.messages.length-1]).color},{default:e(()=>[h(b(I(r.messages[r.messages.length-1]).icon),1)]),_:2},1032,["color"])):F("",!0)],2)],2)],2))),128)):(s(),m(E,{key:1},{default:e(()=>[t(O,{class:"d-flex justify-center text-center text-body-1 align-center"},{default:e(()=>[h(b(a(k).message)+" ",1),a(k).status===0?(s(),m(Y,{key:0,width:3,color:"primary",indeterminate:""})):a(k).status===1?(s(),m(D,{key:1,color:"success",icon:"tabler-tick"})):(s(),m(D,{key:2,color:"error",icon:"tabler-x"}))]),_:1})]),_:1}))])}}},Ie={class:"d-flex flex-column h-100"},De={class:"active-chat-header d-flex align-center text-medium-emphasis"},ze={class:"d-flex align-center cursor-pointer"},Pe={class:"ms-4 mb-4 overflow-hidden"},Te={class:"text-h5 font-weight-regular"},Be={__name:"Chat",props:{trade:{type:Object,default:()=>{},required:!0}},setup(C){const i=C,_=W(),y=g(),w=()=>{const k=y.value.$el||y.value;k.scrollTop=k.scrollHeight},f=g(""),u=()=>{!f.value||(_.postItem({trade:i.trade.id,message:f.value}),console.log(`Msg sent ${f.value}`),f.value="",oe(()=>{w()}))};return(k,v)=>{const I=q("RouterLink"),z=q("PerfectScrollbar");return s(),x("div",null,[t(we,{class:"chat-content-container"},{default:e(()=>[l("div",Ie,[l("div",De,[l("div",ze,[l("div",Pe,[l("h6",Te,[i.trade.item1?(s(),m(I,{key:0,to:{name:"items-view-id",params:{id:i.trade.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[h(b(i.trade.item1.name),1)]),_:1})]),_:1},8,["to"])):F("",!0),t(D,{icon:"tabler-replace"}),i.trade.item2?(s(),m(I,{key:1,to:{name:"items-view-id",params:{id:i.trade.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[h(b(i.trade.item2.name),1)]),_:1})]),_:1},8,["to"])):F("",!0)])])]),t(se)]),t(ve),t(z,{ref_key:"chatLogPS",ref:y,tag:"ul",options:{wheelPropagation:!1},class:"flex-grow-1"},{default:e(()=>[t(Ce,{trade:i.trade},null,8,["trade"])]),_:1},512),t(fe,{class:"chat-log-message-form mx-5",onSubmit:le(u,["prevent"])},{default:e(()=>[(s(),m(pe,{key:i.trade.id,modelValue:a(f),"onUpdate:modelValue":v[0]||(v[0]=M=>U(f)?f.value=M:null),variant:"solo",class:"chat-message-input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435...",density:"default",autofocus:""},{"append-inner":e(()=>[t(A,{class:"mt-n2",rounded:"pill",variant:"tonal",onClick:u},{default:e(()=>[h(" \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C ")]),_:1})]),_:1},8,["modelValue"]))]),_:1},8,["onSubmit"])])]),_:1})])}}},Me={__name:"SendMessageDialog",props:{isDialogVisible:{type:Boolean,required:!0},trade:{type:Object,required:!0}},emits:["update:isDialogVisible"],setup(C,{emit:i}){const _=C,y=w=>{i("update:isDialogVisible",w)};return(w,f)=>{const u=de;return s(),x("div",null,[t(xe,{width:w.$vuetify.display.lgAndUp?"40%":560,"model-value":_.isDialogVisible,"onUpdate:modelValue":y},{default:e(()=>[t(u,{onClick:f[0]||(f[0]=k=>y(!1))}),t(E,{class:"py-8"},{default:e(()=>[t(Be,{trade:_.trade},null,8,["trade"])]),_:1})]),_:1},8,["width","model-value"])])}}},Ue=l("thead",null,[l("tr",null,[l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," # "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0442\u0434\u0430\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0446\u0435\u043D\u043A\u0430 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F ")])],-1),Le={class:"text-high-emphasis"},Re={class:"text-high-emphasis"},je={class:"text-high-emphasis"},Ae={class:"text-high-emphasis"},Fe={class:"text-high-emphasis"},Ne={class:"text-high-emphasis"},Oe={class:"text-high-emphasis"},qe={colspan:"8",class:"text-center text-body-1 justify-center align-center"},Ee={class:"text-sm text-disabled"},st={__name:"index",setup(C){const i=g("created"),_=g(!1),y=g([{name:"\u0412 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435",value:"created"},{name:"\u041F\u0440\u0438\u043D\u044F\u0442\u044B\u0435",value:"accepted"},{name:"\u041E\u0442\u043A\u043B\u043E\u043D\u0451\u043D\u043D\u044B\u0435",value:"not_accepted"}]);ie();const w=re(),f=H(),u=g(null),k=g(10),v=g(1),I=g(1),z=g(0),M=g({}),P=g({}),c=g({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),V=g({enabled:!1,type:"success",message:"Hello!"});R(()=>{u.value===null?c.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}:u.value.length===0&&(c.value={message:"\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432",status:2})}),R(()=>{u.value=null,w.fetchItems({state:i.value}).then(o=>{u.value=o.data,M.value=o.data.length>0?o.data[0]:null}).catch(o=>{V.value={enabled:!0,message:o,type:"error"},console.log(o)})}),R(()=>{v.value>I.value&&(v.value=I.value)});const T=N(()=>{const o=u.value&&u.value.length?(v.value-1)*k.value+1:0,d=u.value?u.value.length+(v.value-1)*k.value:0;return`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u044B \u0441 ${o} \u043F\u043E ${d} \u0438\u0437 ${z.value} \u0441\u0442\u0440\u043E\u043A`}),r=async(o,d)=>{w.patchItem({id:o,state:d}).then($=>{if(console.log($.data),u.value=u.value.filter(p=>p.id!==o),$.status>250)throw`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F: ${JSON.stringify($.data)}`;V.value={enabled:!0,message:`\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0431\u043C\u0435\u043D\u0430 ${o} \u0438\u0437\u043C\u0435\u043D\u0451\u043D`,type:"success"}}).catch($=>{V.value={enabled:!0,message:$,type:"error"},console.log($)})};return(o,d)=>{const $=q("RouterLink");return s(),x("div",null,[t(ne,{modelValue:a(V).enabled,"onUpdate:modelValue":d[0]||(d[0]=p=>a(V).enabled=p),location:"top end",variant:"flat",color:a(V).type},{default:e(()=>[h(b(a(V).message),1)]),_:1},8,["modelValue","color"]),t(_e,{modelValue:a(i),"onUpdate:modelValue":d[1]||(d[1]=p=>U(i)?i.value=p:null),class:"mb-1"},{default:e(()=>[(s(!0),x(B,null,j(a(y),p=>(s(),m(be,{key:p.value,value:p.value},{default:e(()=>[h(b(p.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(E,{flat:""},{default:e(()=>[t(O,null,{default:e(()=>[t(he,{modelValue:a(i),"onUpdate:modelValue":d[3]||(d[3]=p=>U(i)?i.value=p:null)},{default:e(()=>[(s(!0),x(B,null,j(a(y),p=>(s(),m(ye,{key:p.value,value:p.value},{default:e(()=>[t(ke,{class:"text-no-wrap pb-5"},{default:e(()=>[Ue,l("tbody",null,[(s(!0),x(B,null,j(a(u),n=>(s(),x("tr",{key:n.id,style:{height:"3.5rem"}},[l("td",Le,b(n.id),1),a(f).userData.id===n.user?(s(),x(B,{key:0},[l("td",Re,[n.item1?(s(),m($,{key:0,to:{name:"items-view-id",params:{id:n.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(n.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))]),l("td",je,[n.item2?(s(),m($,{key:0,to:{name:"items-view-id",params:{id:n.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(n.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))])],64)):(s(),x(B,{key:1},[l("td",Ae,[n.item2?(s(),m($,{key:0,to:{name:"items-view-id",params:{id:n.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(n.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))]),l("td",Fe,[n.item1?(s(),m($,{key:0,to:{name:"items-view-id",params:{id:n.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(n.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))])],64)),l("td",Ne,[t(S,{color:"warning",variant:"tonal","append-icon":"tabler-star"},{default:e(()=>[h(b(n.mark?n.mark:"-"),1)]),_:2},1024)]),l("td",Oe,[n.state==="created"&&n.user!==a(f).userData.id?(s(),x(B,{key:0},[t(A,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>r(n.id,"accepted")},{default:e(()=>[t(D,{size:"22",icon:"tabler-circle-check"})]),_:2},1032,["onClick"]),t(A,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>r(n.id,"not_accepted")},{default:e(()=>[t(D,{size:"22",icon:"tabler-circle-x"})]),_:2},1032,["onClick"])],64)):F("",!0),t(A,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>{P.value=JSON.parse(JSON.stringify(n)),_.value=!0}},{default:e(()=>[t(D,{size:"22",icon:"tabler-message"})]),_:2},1032,["onClick"])])]))),128))]),ue(l("tfoot",null,[l("tr",null,[l("td",qe,[h(b(a(c).message)+" ",1),a(c).status===0?(s(),m(Y,{key:0,width:3,color:"primary",indeterminate:""})):a(c).status===1?(s(),m(D,{key:1,color:"success",icon:"tabler-tick"})):(s(),m(D,{key:2,color:"error",icon:"tabler-x"}))])])],512),[[ce,!a(u)||!a(u).length]])]),_:1}),t(O,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3"},{default:e(()=>[l("span",Ee,b(a(T)),1),t(Ve,{modelValue:a(v),"onUpdate:modelValue":d[2]||(d[2]=n=>U(v)?v.value=n:null),size:"small","total-visible":4,length:a(I)},null,8,["modelValue","length"])]),_:1})]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Me,{trade:a(P),"onUpdate:trade":d[4]||(d[4]=p=>U(P)?P.value=p:null),"is-dialog-visible":a(_),"onUpdate:is-dialog-visible":d[5]||(d[5]=p=>U(_)?_.value=p:null)},null,8,["trade","is-dialog-visible"])]),_:1})])}}};export{st as default};
