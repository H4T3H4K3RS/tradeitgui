import{a as U}from"./formatters.1dc76301.js";import{R as E,S as M,U as X,W as Y,X as F,Y as j,Z as G,$ as H,a0 as $,a1 as J,a2 as K,a3 as O,a4 as Q,a5 as W,a6 as Z,a7 as tt,p as a,a8 as et,a9 as at,aa as ot,O as p,G as L,o as c,b as _,x as n,Q as nt,J as it,K as k,H as st,C as B,z as y,I as N,P as S,c as V,a as lt,F as I,L as w,D as P,q as R,m as rt,ab as ct,ac as d,k as C,ad as ut,ae as dt,w as ft,af as mt}from"./index.209d9e67.js";import{V as T}from"./VListItemAction.df062909.js";const A=E({name:"VBadge",inheritAttrs:!1,props:{bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:M,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...X({location:"top end"}),...Y(),...F(),...j(),...G({transition:"scale-rotate-transition"})},setup(t,s){const{backgroundColorClasses:e,backgroundColorStyles:f}=H($(t,"color")),{roundedClasses:l}=J(t),{t:o}=K(),{textColorClasses:m,textColorStyles:i}=O($(t,"textColor")),{themeClasses:r}=Q(),{locationStyles:u}=W(t,!0,g=>{var b,v;return(t.floating?t.dot?2:4:t.dot?8:12)+(["top","bottom"].includes(g)?+((b=t.offsetY)!=null?b:0):["left","right"].includes(g)?+((v=t.offsetX)!=null?v:0):0)});return Z(()=>{var g,x,b,v;const h=Number(t.content),z=!t.max||isNaN(h)?t.content:h<=t.max?h:`${t.max}+`,[q,D]=tt(s.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return a(t.tag,p({class:["v-badge",{"v-badge--bordered":t.bordered,"v-badge--dot":t.dot,"v-badge--floating":t.floating,"v-badge--inline":t.inline}]},D),{default:()=>[a("div",{class:"v-badge__wrapper"},[(g=(x=s.slots).default)==null?void 0:g.call(x),a(et,{transition:t.transition},{default:()=>[at(a("span",p({class:["v-badge__badge",r.value,e.value,l.value,m.value],style:[f.value,i.value,t.inline?{}:u.value],"aria-atomic":"true","aria-label":o(t.label,h),"aria-live":"polite",role:"status"},q),[t.dot?void 0:s.slots.badge?(b=(v=s.slots).badge)==null?void 0:b.call(v):t.icon?a(L,{icon:t.icon},null):z]),[[ot,t.modelValue]])]})])]})}),{}}});const gt={key:0},bt={class:"whitespace-no-wrap text-medium-emphasis"},vt={__name:"Notifications",props:{notifications:{type:Array,required:!0},badgeProps:{type:null,required:!1,default:void 0},location:{type:null,required:!1,default:"bottom end"}},emits:["click:readAllNotifications"],setup(t,{emit:s}){const e=t;return(f,l)=>(c(),_(A,p({"model-value":!!e.badgeProps},e.badgeProps),{default:n(()=>[a(P,{icon:"",variant:"text",color:"default",size:"small"},{default:n(()=>[a(A,{"model-value":!!e.notifications.length,color:"error",content:e.notifications.length},{default:n(()=>[a(L,{icon:"tabler-bell",size:"24"})]),_:1},8,["model-value","content"]),a(nt,{activator:"parent",width:"380px",location:e.location,offset:"14px"},{default:n(()=>[a(it,{class:"py-0"},{default:n(()=>[a(k,{title:"\u0423\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F",class:"notification-section",height:"48px"},{append:n(()=>[e.notifications&&e.notifications.length?(c(),_(st,{key:0,color:"primary",size:"small"},{default:n(()=>[B(y(e.notifications&&e.notifications.length?e.notifications.length:0)+" \u041D\u043E\u0432\u044B\u0445 ",1)]),_:1})):N("",!0)]),_:1}),a(S),e.notifications&&e.notifications.length!==0?(c(!0),V(I,{key:0},lt(e.notifications,o=>(c(),V(I,{key:o.id},[a(k,{title:o.message,subtitle:o.subtitle,link:"",lines:"one","min-height":"66px"},{prepend:n(()=>[a(T,{start:""},{default:n(()=>[a(w,{color:o.color||"primary",image:o.img||void 0,icon:o.icon||void 0,size:"40",variant:"tonal"},{default:n(()=>[o.text?(c(),V("span",gt,y(R(U)(o.text)),1)):N("",!0)]),_:2},1032,["color","image","icon"])]),_:2},1024)]),append:n(()=>[rt("small",bt,y(o.time),1)]),_:2},1032,["title","subtitle"]),a(S)],64))),128)):(c(),_(k,{key:1,class:"mb-1",title:"\u0423\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439 \u043D\u0435\u0442!",link:"",lines:"one","min-height":"66px"},{prepend:n(()=>[a(T,{start:""},{default:n(()=>[a(w,{color:"success",icon:"tabler-check",size:"40",variant:"tonal"})]),_:1})]),_:1})),e.notifications&&e.notifications.length!==0?(c(),_(k,{key:2,class:"notification-section"},{default:n(()=>[a(P,{block:"",onClick:l[0]||(l[0]=o=>f.$emit("click:readAllNotifications",e.notifications.map(m=>m.id).join(",")))},{default:n(()=>[B(" \u041E\u0442\u043C\u0435\u0442\u0438\u0442\u044C \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043D\u044B\u043C\u0438 ")]),_:1})]),_:1})):N("",!0)]),_:1})]),_:1},8,["location"])]),_:1})]),_:1},16,["model-value"]))}},_t=ct({id:"notificationStore",actions:{fetchItems(t){return d.get("/notification/",{params:t})},fetchItem(t){return d.get(`/notification/${t.id}/`,{params:t})},postItem(t){return d.post("/notification/",t)},patchItem(t){return d.patch(`/notification/${t.id}/`,t)},putItem(t){return d.put(`/notification/${t.id}/`,t)},deleteItem(t){return d.delete(`/notification/${t.id}/`,{params:t})},read(t){return d.post("/bulk_update_notifications/",t)}}}),yt={__name:"NavBarNotifications",setup(t){const s=C(600),e=C(null),f=_t(),l=C([]);ut(()=>{o(),e.value=setInterval(o,1e3)}),dt(()=>{clearInterval(e.value)});const o=(i=!0)=>{i&&s.value<=0||(s.value-=1)};ft(()=>{if(s.value===0){console.log("Reload");return}f.fetchItems({state:"not_shown"}).then(i=>{if(i.status>399)throw`\u041E\u0448\u0438\u0431\u043A\u0430: ${i.status}`;console.log(i.data);let r=i.data.results;r.forEach(u=>{u.icon="tabler-bell"}),l.value=r}).catch(i=>{})});const m=i=>{console.log(i),f.read({data:i})};return(i,r)=>(c(),_(vt,{notifications:R(l),"onUpdate:notifications":r[0]||(r[0]=u=>mt(l)?l.value=u:null),"onClick:readAllNotifications":r[1]||(r[1]=u=>m(u))},null,8,["notifications"]))}};export{yt as default};
