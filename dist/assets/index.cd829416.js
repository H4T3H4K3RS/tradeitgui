import{J as K,O as Q,bl as X,$ as Z,p as t,k as p,v as H,bm as W,am as N,w as R,bn as G,bo as ee,o as a,c as x,q as s,F as B,a as j,s as L,m as l,x as e,bp as te,G as ae,z as b,b as m,C as h,E as z,aY as F,be as O,ar as Y,b4 as E,r as q,H as S,A as se,bq as le,b0 as U,a4 as oe,br as re,bd as ne,j as ie,an as ue,az as ce}from"./index.fb06f4e2.js";import{_ as de}from"./DialogCloseBtn.13d3ced6.js";import{f as me}from"./formatters.1dc76301.js";import{V as ve}from"./VDivider.10f9f2dc.js";import{V as fe}from"./VForm.eb8b2bad.js";import{V as pe}from"./VTextField.37f15681.js";import{V as A}from"./VBtn.bb737e20.js";import{u as ge,V as _e,a as he,b as be,c as ye}from"./VTabs.64dfe3b7.js";import{V as xe}from"./VDialog.e99fd99e.js";import{V as ke,a as Ve}from"./VTable.9818c3c9.js";import"./VCounter.1b890e6b.js";import"./dialog-transition.474a4586.js";const we=K({name:"VMain",props:{scrollable:Boolean,...Q({tag:"main"})},setup(C,n){let{slots:g}=n;const{mainStyles:y}=X(),{ssrBootStyles:w}=ge();return Z(()=>{var _,i;return t(C.tag,{class:["v-main",{"v-main--scrollable":C.scrollable}],style:[y.value,w.value]},{default:()=>[C.scrollable?t("div",{class:"v-main__scroller"},[(_=g.default)==null?void 0:_.call(g)]):(i=g.default)==null?void 0:i.call(g)]})}),{}}});const $e={class:"chat-log pa-5"},Se={class:"text-xs me-1 text-disabled"},Ce={__name:"ChatLog",props:{trade:{type:Object,default:()=>{},required:!0}},setup(C){const n=C,g="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Font_Awesome_5_solid_user-circle.svg/1200px-Font_Awesome_5_solid_user-circle.svg.png",y=p(600),w=p(null),_=H(),i=W(),k=p({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u{1F9E0}",status:0}),v=N(()=>({id:_.userData.id,avatar:g})),I=c=>c.state==="shown"?{icon:"tabler-checks",color:"success"}:{icon:"tabler-check",color:void 0},D=p(null);R(()=>{D.value===null?k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u{1F9E0}",status:0}:D.value.length===0&&(k.value={message:"\u041D\u0435\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439",status:2})}),G(()=>{M(),w.value=setInterval(M,1e3)}),ee(()=>{clearInterval(w.value)});const M=(c=!0)=>{c&&y.value<=0||(c||(k.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),y.value-=1)};R(()=>{if(y.value===0){console.log("Reload");return}i.fetchItems({trade:n.trade.id}).then(c=>{if(c.status>399)throw`\u041E\u0448\u0438\u0431\u043A\u0430: ${c.status}`;console.log(c.data),D.value=c.data}).catch(c=>{snackbar.value={enabled:!0,message:c,type:"error"}})});const P=N(()=>{const c=[];let V=D.value;if(!V||V.length===0)return[];let T=V[0].user,r={senderId:T,messages:[]};return V.forEach((o,d)=>{T===o.user?r.messages.push({message:o.message,time:o.time_created,state:o.state}):(T=o.user,c.push(r),r={senderId:o.user,messages:[{message:o.message,time:o.time_created,state:o.state}]}),d===V.length-1&&c.push(r)}),c});return(c,V)=>{var T;return a(),x("div",$e,[(T=s(P))!=null&&T.length?(a(!0),x(B,{key:0},j(s(P),(r,o)=>(a(),x("div",{key:r.senderId+String(o),class:L(["chat-group d-flex align-start",[{"flex-row-reverse":r.senderId===s(v).id,"mb-8":s(P).length-1!==o}]])},[l("div",{class:L(["chat-avatar",r.senderId===s(v).id?"ms-4":"me-4"])},[t(ae,{size:"38"},{default:e(()=>[t(te,{src:r.senderId!==s(v).id?s(v).avatar:g},null,8,["src"])]),_:2},1024)],2),l("div",{class:L(["chat-body d-inline-flex flex-column",r.senderId===s(v).id?"align-end":"align-start"])},[(a(!0),x(B,null,j(r.messages,(d,$)=>(a(),x("p",{key:d.time,class:L(["chat-content text-sm py-3 px-4 elevation-1",[r.senderId!==s(v).id?"bg-surface chat-left":"bg-primary text-white chat-right",r.messages.length-1!==$?"mb-2":"mb-1"]])},b(d.message),3))),128)),l("div",{class:L({"text-right":r.senderId===s(v).id})},[l("span",Se,b(s(me)(r.messages[r.messages.length-1].time,{hour:"numeric",minute:"numeric"})),1),r.senderId===s(v).id?(a(),m(z,{key:0,size:"16",color:I(r.messages[r.messages.length-1]).color},{default:e(()=>[h(b(I(r.messages[r.messages.length-1]).icon),1)]),_:2},1032,["color"])):F("",!0)],2)],2)],2))),128)):(a(),m(E,{key:1},{default:e(()=>[t(O,{class:"d-flex justify-center text-center text-body-1 align-center"},{default:e(()=>[h(b(s(k).message)+" ",1),s(k).status===0?(a(),m(Y,{key:0,width:3,color:"primary",indeterminate:""})):s(k).status===1?(a(),m(z,{key:1,color:"success",icon:"tabler-tick"})):(a(),m(z,{key:2,color:"error",icon:"tabler-x"}))]),_:1})]),_:1}))])}}},Ie={class:"d-flex flex-column h-100"},ze={class:"active-chat-header d-flex align-center text-medium-emphasis"},De={class:"d-flex align-center cursor-pointer"},Pe={class:"ms-4 mb-4 overflow-hidden"},Te={class:"text-h5 font-weight-regular"},Be={__name:"Chat",props:{trade:{type:Object,default:()=>{},required:!0}},setup(C){const n=C,g=W(),y=p(),w=()=>{const k=y.value.$el||y.value;k.scrollTop=k.scrollHeight},_=p(""),i=()=>{!_.value||(g.postItem({trade:n.trade.id,message:_.value}),console.log(`Msg sent ${_.value}`),_.value="",oe(()=>{w()}))};return(k,v)=>{const I=q("RouterLink"),D=q("PerfectScrollbar");return a(),x("div",null,[t(we,{class:"chat-content-container"},{default:e(()=>[l("div",Ie,[l("div",ze,[l("div",De,[l("div",Pe,[l("h6",Te,[n.trade.item1?(a(),m(I,{key:0,to:{name:"items-view-id",params:{id:n.trade.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[h(b(n.trade.item1.name),1)]),_:1})]),_:1},8,["to"])):F("",!0),t(z,{icon:"tabler-replace"}),n.trade.item2?(a(),m(I,{key:1,to:{name:"items-view-id",params:{id:n.trade.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",size:"large",variant:"tonal"},{default:e(()=>[h(b(n.trade.item2.name),1)]),_:1})]),_:1},8,["to"])):F("",!0)])])]),t(se)]),t(ve),t(D,{ref_key:"chatLogPS",ref:y,tag:"ul",options:{wheelPropagation:!1},class:"flex-grow-1"},{default:e(()=>[t(Ce,{trade:n.trade},null,8,["trade"])]),_:1},512),t(fe,{class:"chat-log-message-form mx-5",onSubmit:le(i,["prevent"])},{default:e(()=>[(a(),m(pe,{key:n.trade.id,modelValue:s(_),"onUpdate:modelValue":v[0]||(v[0]=M=>U(_)?_.value=M:null),variant:"solo",class:"chat-message-input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435...",density:"default",autofocus:""},{"append-inner":e(()=>[t(A,{class:"mt-n2",rounded:"pill",variant:"tonal",onClick:i},{default:e(()=>[h(" \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C ")]),_:1})]),_:1},8,["modelValue"]))]),_:1},8,["onSubmit"])])]),_:1})])}}},Me={__name:"SendMessageDialog",props:{isDialogVisible:{type:Boolean,required:!0},trade:{type:Object,required:!0}},emits:["update:isDialogVisible"],setup(C,{emit:n}){const g=C,y=w=>{n("update:isDialogVisible",w)};return(w,_)=>{const i=de;return a(),x("div",null,[t(xe,{width:w.$vuetify.display.lgAndUp?"40%":560,"model-value":g.isDialogVisible,"onUpdate:modelValue":y},{default:e(()=>[t(i,{onClick:_[0]||(_[0]=k=>y(!1))}),t(E,{class:"py-8"},{default:e(()=>[t(Be,{trade:g.trade},null,8,["trade"])]),_:1})]),_:1},8,["width","model-value"])])}}},Ue=l("thead",null,[l("tr",null,[l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," # "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0442\u0434\u0430\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u043D\u044B\u0439 \u041F\u0440\u0435\u0434\u043C\u0435\u0442 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u041E\u0446\u0435\u043D\u043A\u0430 "),l("th",{scope:"col",class:"text-subtitle-2 text-wrap"}," \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F ")])],-1),Le={class:"text-high-emphasis"},Re={class:"text-high-emphasis"},je={class:"text-high-emphasis"},Ae={class:"text-high-emphasis"},Fe={class:"text-high-emphasis"},Ne={class:"text-high-emphasis"},Oe={class:"text-high-emphasis"},qe={colspan:"8",class:"text-center text-body-1 justify-center align-center"},Ee={class:"text-sm text-disabled"},st={__name:"index",setup(C){const n=p("created"),g=p(!1),y=p([{name:"\u0412 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435",value:"created"},{name:"\u041E\u0442\u043A\u043B\u043E\u043D\u0451\u043D\u043D\u044B\u0435",value:"not_accepted"},{name:"\u041F\u0440\u0438\u043D\u044F\u0442\u044B\u0435",value:"accepted"}]);ie();const w=re(),_=H(),i=p(null),k=p(10),v=p(1),I=p(1),D=p(0),M=p({}),P=p({}),c=p({message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}),V=p({enabled:!1,type:"success",message:"Hello!"});R(()=>{i.value===null?c.value={message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",status:0}:i.value.length===0&&(c.value={message:"\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432",status:2})}),R(()=>{i.value=null,w.fetchItems({state:n.value}).then(o=>{i.value=o.data,M.value=o.data.length>0?o.data[0]:null}).catch(o=>{V.value={enabled:!0,message:o,type:"error"},console.log(o)})}),R(()=>{v.value>I.value&&(v.value=I.value)});const T=N(()=>{const o=i.value&&i.value.length?(v.value-1)*k.value+1:0,d=i.value?i.value.length+(v.value-1)*k.value:0;return`\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u044B \u0441 ${o} \u043F\u043E ${d} \u0438\u0437 ${D.value} \u0441\u0442\u0440\u043E\u043A`}),r=async(o,d)=>{w.patchItem({id:o,state:d}).then($=>{if(console.log($.data),i.value=i.value.filter(f=>f.id!==o),$.status>250)throw`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F: ${JSON.stringify($.data)}`;V.value={enabled:!0,message:`\u0421\u0442\u0430\u0442\u0443\u0441 \u043E\u0431\u043C\u0435\u043D\u0430 ${o} \u0438\u0437\u043C\u0435\u043D\u0451\u043D`,type:"success"}}).catch($=>{V.value={enabled:!0,message:$,type:"error"},console.log($)})};return(o,d)=>{const $=q("RouterLink");return a(),x("div",null,[t(ne,{modelValue:s(V).enabled,"onUpdate:modelValue":d[0]||(d[0]=f=>s(V).enabled=f),location:"top end",variant:"flat",color:s(V).type},{default:e(()=>[h(b(s(V).message),1)]),_:1},8,["modelValue","color"]),t(_e,{modelValue:s(n),"onUpdate:modelValue":d[1]||(d[1]=f=>U(n)?n.value=f:null),class:"mb-1"},{default:e(()=>[(a(!0),x(B,null,j(s(y),f=>(a(),m(be,{key:f.value,value:f.value},{default:e(()=>[h(b(f.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(E,{flat:""},{default:e(()=>[t(O,null,{default:e(()=>[t(he,{modelValue:s(n),"onUpdate:modelValue":d[3]||(d[3]=f=>U(n)?n.value=f:null)},{default:e(()=>[(a(!0),x(B,null,j(s(y),f=>(a(),m(ye,{key:f.value,value:f.value},{default:e(()=>[t(ke,{class:"text-no-wrap pb-5"},{default:e(()=>[Ue,l("tbody",null,[(a(!0),x(B,null,j(s(i),u=>(a(),x("tr",{key:u.id,style:{height:"3.5rem"}},[l("td",Le,b(u.id),1),s(_).userData.id===u.user?(a(),x(B,{key:0},[l("td",Re,[u.item1?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(u.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))]),l("td",je,[u.item2?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(u.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041D\u0438\u0447\u0435\u0433\u043E ")]),_:1}))])],64)):(a(),x(B,{key:1},[l("td",Ae,[u.item2?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item2.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(u.item2.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))]),l("td",Fe,[u.item1?(a(),m($,{key:0,to:{name:"items-view-id",params:{id:u.item1.id}}},{default:e(()=>[t(S,{class:"cursor-pointer",color:"primary",variant:"tonal"},{default:e(()=>[h(b(u.item1.name),1)]),_:2},1024)]),_:2},1032,["to"])):(a(),m(S,{key:1,color:"error",variant:"tonal"},{default:e(()=>[h(" \u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1}))])],64)),l("td",Ne,[t(S,{color:"warning",variant:"tonal","append-icon":"tabler-star"},{default:e(()=>[h(b(u.mark?u.mark:"-"),1)]),_:2},1024)]),l("td",Oe,[u.state==="created"?(a(),x(B,{key:0},[t(A,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>r(u.id,"accepted")},{default:e(()=>[t(z,{size:"22",icon:"tabler-circle-check"})]),_:2},1032,["onClick"]),t(A,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>r(u.id,"not_accepted")},{default:e(()=>[t(z,{size:"22",icon:"tabler-circle-x"})]),_:2},1032,["onClick"])],64)):F("",!0),t(A,{icon:"",size:"x-small",color:"default",variant:"text",onClick:J=>{P.value=JSON.parse(JSON.stringify(u)),g.value=!0}},{default:e(()=>[t(z,{size:"22",icon:"tabler-message"})]),_:2},1032,["onClick"])])]))),128))]),ue(l("tfoot",null,[l("tr",null,[l("td",qe,[h(b(s(c).message)+" ",1),s(c).status===0?(a(),m(Y,{key:0,width:3,color:"primary",indeterminate:""})):s(c).status===1?(a(),m(z,{key:1,color:"success",icon:"tabler-tick"})):(a(),m(z,{key:2,color:"error",icon:"tabler-x"}))])])],512),[[ce,!s(i)||!s(i).length]])]),_:1}),t(O,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3"},{default:e(()=>[l("span",Ee,b(s(T)),1),t(Ve,{modelValue:s(v),"onUpdate:modelValue":d[2]||(d[2]=u=>U(v)?v.value=u:null),size:"small","total-visible":4,length:s(I)},null,8,["modelValue","length"])]),_:1})]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Me,{trade:s(P),"onUpdate:trade":d[4]||(d[4]=f=>U(P)?P.value=f:null),"is-dialog-visible":s(g),"onUpdate:is-dialog-visible":d[5]||(d[5]=f=>U(g)?g.value=f:null)},null,8,["trade","is-dialog-visible"])]),_:1})])}}};export{st as default};
